
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>50.043 Query Operations - Database System and Big Data 50.043</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSpline+Sans+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Spline Sans Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#50043-query-operations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Database System and Big Data 50.043" class="md-header__button md-logo" aria-label="Database System and Big Data 50.043" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"/><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Database System and Big Data 50.043
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              50.043 Query Operations
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../l1_course_handout/" class="md-tabs__link">
        
  
    
  
  Handout

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Database System and Big Data 50.043" class="md-nav__button md-logo" aria-label="Database System and Big Data 50.043" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"/><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"/></svg>

    </a>
    Database System and Big Data 50.043
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../l1_course_handout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handout
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Outcomes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recap-relational-algebra" class="md-nav__link">
    <span class="md-ellipsis">
      Recap Relational Algebra
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#selection-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Selection Operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Selection Operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sequential-scanning" class="md-nav__link">
    <span class="md-ellipsis">
      Sequential Scanning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scanning-with-b-tree-index" class="md-nav__link">
    <span class="md-ellipsis">
      Scanning with B+ Tree index
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scanning with B+ Tree index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#case-1-clustered-index" class="md-nav__link">
    <span class="md-ellipsis">
      Case 1: Clustered index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-2-unclustered-index" class="md-nav__link">
    <span class="md-ellipsis">
      Case 2: Unclustered Index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sort-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Sort Operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sort Operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-sort" class="md-nav__link">
    <span class="md-ellipsis">
      External Sort
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Sort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recap-merge-sort" class="md-nav__link">
    <span class="md-ellipsis">
      Recap Merge sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-sort_1" class="md-nav__link">
    <span class="md-ellipsis">
      External sort
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External sort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#external-sort-by-example" class="md-nav__link">
    <span class="md-ellipsis">
      External sort by example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External sort by example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-0" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-sort-algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      External sort algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External sort algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-function-divide_n_sort" class="md-nav__link">
    <span class="md-ellipsis">
      Helper function divide_n_sort
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-function-merge" class="md-nav__link">
    <span class="md-ellipsis">
      Helper function merge
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cost-estimation-for-external-sort" class="md-nav__link">
    <span class="md-ellipsis">
      Cost estimation for External sort
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#join-operation" class="md-nav__link">
    <span class="md-ellipsis">
      Join Operation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Join Operation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nested-loop-join" class="md-nav__link">
    <span class="md-ellipsis">
      Nested Loop Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#block-nested-loop-join" class="md-nav__link">
    <span class="md-ellipsis">
      Block Nested Loop Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-nested-loop-join" class="md-nav__link">
    <span class="md-ellipsis">
      Index Nested Loop Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sort-merge-join" class="md-nav__link">
    <span class="md-ellipsis">
      Sort Merge Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hash-join" class="md-nav__link">
    <span class="md-ellipsis">
      Hash Join
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grace-hash-join" class="md-nav__link">
    <span class="md-ellipsis">
      Grace Hash Join
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="50043-query-operations">50.043 Query Operations<a class="headerlink" href="#50043-query-operations" title="Permanent link">&para;</a></h1>
<h2 id="learning-outcomes">Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Permanent link">&para;</a></h2>
<p>By the end of this unit, you should be able to </p>
<ul>
<li>assess estimated cost of database operation, namely, select, sort and join</li>
<li>describe the external sort algorithm</li>
<li>describe nested loop join, block nested loop join, index nested join, sort merge join and hash join</li>
</ul>
<h2 id="recap-relational-algebra">Recap Relational Algebra<a class="headerlink" href="#recap-relational-algebra" title="Permanent link">&para;</a></h2>
<p>Recall that in week 2, we investigated into relation model and relational alegbra. We argue that relational algebra is a good abstraction to describe data processing operation over a relational model. </p>
<p>Given that we know a bit more of the internal implementation of a physical database, (the data structure aspect) we start look into possible ways of implemeting the relational algebra operations in a physical datase (the algorithm aspect).</p>
<h2 id="selection-operation">Selection Operation<a class="headerlink" href="#selection-operation" title="Permanent link">&para;</a></h2>
<p>Let <span class="arithmatex">\(R\)</span> denote a relation (or in other words, a table), we consider the selection operation <span class="arithmatex">\(\sigma_{C}(R)\)</span> where <span class="arithmatex">\(C\)</span> is a logical predicate. The result of this operation is a new relation whose tuples are those coming from <span class="arithmatex">\(R\)</span> and satisfying the predicate <span class="arithmatex">\(C\)</span>. </p>
<p>There are several ways to implement this operation. </p>
<h3 id="sequential-scanning">Sequential Scanning<a class="headerlink" href="#sequential-scanning" title="Permanent link">&para;</a></h3>
<p>Knowing that the data in <span class="arithmatex">\(R\)</span> are stored in a Heap file as a set of Heap pages, we could scan <span class="arithmatex">\(R\)</span> by reading the data from <span class="arithmatex">\(R\)</span> page by page. For each tuple in the page, we remove it when it does not satisfy <span class="arithmatex">\(C\)</span> and retain it otherwise. </p>
<p>The cost (in terms of number of Disk I/Os) of using the sequential scanning approach is <span class="arithmatex">\(B(R)\)</span>,
where <span class="arithmatex">\(B(R)\)</span> denotes the number of pages storing <span class="arithmatex">\(R\)</span>.</p>
<h3 id="scanning-with-b-tree-index">Scanning with B+ Tree index<a class="headerlink" href="#scanning-with-b-tree-index" title="Permanent link">&para;</a></h3>
<p>A <em>smarter</em> (but not always) way is to make use to the B+ tree index created over the attributes mentioned in <span class="arithmatex">\(C\)</span>. </p>
<h4 id="case-1-clustered-index">Case 1: Clustered index<a class="headerlink" href="#case-1-clustered-index" title="Permanent link">&para;</a></h4>
<p>In this case the B+ Tree index is clustered, i.e. the data in the pages are stored according to the order of the index attribute. </p>
<p>We have to traverse down the B+ Tree to find the boundaries of <span class="arithmatex">\(C\)</span>, and for each leaf node value (reference) we retrieve the page storing that tuple and check whether that tuple satisfies <span class="arithmatex">\(C\)</span>.</p>
<p>Assuming each node in the B+ Tree occupies a page, the cost of this approach is </p>
<div class="arithmatex">\[
log_d(|R|/d) + \alpha(C,R) \cdot B(R)
\]</div>
<p>Where <span class="arithmatex">\(|R|\)</span> denotes the number of tuples in <span class="arithmatex">\(R\)</span>, <span class="arithmatex">\(d\)</span> denotes the order of the B+Tree. <span class="arithmatex">\((|R|/d)\)</span> is number of leaf nodes in the B+ Tree, which is the worst case, every node is just half-full. For simplicity, we assume root node is having at least <span class="arithmatex">\(d\)</span> entries. <span class="arithmatex">\(\alpha(C,R)\)</span> denotes the selectivity of the predicate <span class="arithmatex">\(C\)</span> over <span class="arithmatex">\(R\)</span>, i.e. the number of tuples <span class="arithmatex">\(R\)</span> satisfying <span class="arithmatex">\(C\)</span> divided by <span class="arithmatex">\(|R|\)</span>.</p>
<p>The first term <span class="arithmatex">\(log_d(|R|/d)\)</span> estimates the cost of traversing the B+ Tree to find the correct starting leaf node. <span class="arithmatex">\(\alpha(C,R) \cdot B(R)\)</span> estimates the cost of scanning the tuples of <span class="arithmatex">\(R\)</span>. Since the index is clustered, tuples that are stored in the order of the index attributes, we can fetch adjacient tuple w.r.t the attribute referred in <span class="arithmatex">\(C\)</span> in a single page.</p>
<h4 id="case-2-unclustered-index">Case 2: Unclustered Index<a class="headerlink" href="#case-2-unclustered-index" title="Permanent link">&para;</a></h4>
<p>When the B+ Tree is not clustered, the estimated cost becomes</p>
<div class="arithmatex">\[
log_d(|R|/d) + \alpha(C,R) \cdot | R |
\]</div>
<p>A page read is needed for every tuple (in the worst case). </p>
<p>As we can see that when <span class="arithmatex">\(\alpha(C,R) &gt; (1 / pagesize)\)</span>, it is definitely more viable to abandon the index and go for the sequential scan.</p>
<p>One possible improvement of using unclustered index is </p>
<ol>
<li>traverse down the B+ Tree to find the correct starting and ending tuple locations (i.e. page id and slot id), </li>
<li>sort all the tuple locations by page ids before </li>
<li>reading the sorted pages and filter.</li>
</ol>
<p>This will bring us back to the same estimated cost as the clustered index (modular the cost of sorting).</p>
<h2 id="sort-operation">Sort Operation<a class="headerlink" href="#sort-operation" title="Permanent link">&para;</a></h2>
<p>Sorting is essential. </p>
<p>From Data Driven World and Algorithms, we learned various sorting algorthms. All of these algorithms assumes that the data can fit in the RAM. In the settings of database operations, this assumption is no longer valid. </p>
<h3 id="external-sort">External Sort<a class="headerlink" href="#external-sort" title="Permanent link">&para;</a></h3>
<p>The external sorting algorithm is an instance of the merge sort. </p>
<h4 id="recap-merge-sort">Recap Merge sort<a class="headerlink" href="#recap-merge-sort" title="Permanent link">&para;</a></h4>
<p>The merge sort algorithm is as follows</p>
<ol>
<li>def merge_sort(input)<ol>
<li>if input size &lt; 2<ol>
<li>return input, it is already sorted</li>
</ol>
</li>
<li>otherwise<ol>
<li>divide input into halves, say, i1 and i2</li>
<li>call merge_sort(i1) to get s1</li>
<li>call merge_sort(i2) to get s2</li>
<li>combine(s1,s2) to get sorted</li>
<li>return sorted</li>
</ol>
</li>
</ol>
</li>
<li>def combine(s1, s2)<ol>
<li>create an empty list out</li>
<li>while s1 is not empty and s2 is not empty<ol>
<li>let e1 be the first element of s1</li>
<li>let e2 be the first element of s2</li>
<li>if e1 &lt; e2<ol>
<li>add e1 to out</li>
<li>remove e1 from s1</li>
</ol>
</li>
<li>otherwise<ol>
<li>add e2 to out</li>
<li>remove e2 from s2</li>
</ol>
</li>
</ol>
</li>
<li>if s1 is not empty<ol>
<li>concatenate s1 to out</li>
</ol>
</li>
<li>if s2 is not empty <ol>
<li>concatentate s2 to out</li>
</ol>
</li>
<li>return out </li>
</ol>
</li>
</ol>
<h4 id="external-sort_1">External sort<a class="headerlink" href="#external-sort_1" title="Permanent link">&para;</a></h4>
<p>The external sort algorithm is a generalized version of merge sort, which operates without loading the full set of data into RAM.</p>
<h5 id="external-sort-by-example">External sort by example<a class="headerlink" href="#external-sort-by-example" title="Permanent link">&para;</a></h5>
<p>The algorithm makes use of the buffer pool.</p>
<p>Let's consider an example. Suppose we have a buffer pool of 3 frames and would like to sort the following 8 pages of data. Each page contains two tuples. </p>
<p><img alt="" src="../images/ext_sort1.png" /></p>
<h6 id="phase-0">Phase 0<a class="headerlink" href="#phase-0" title="Permanent link">&para;</a></h6>
<p>In this phase, we divide the input pages into <span class="arithmatex">\(\lceil8/3 \rceil = 3\)</span> runs and sort each run.
<img alt="" src="../images/ext_sort2.png" />  </p>
<p>From the next phase onwards, we merge each the sorted runs into larger runs, until all are merged into a single one run.</p>
<h6 id="phase-1">Phase 1<a class="headerlink" href="#phase-1" title="Permanent link">&para;</a></h6>
<p>We merge 3 runs into two runs. </p>
<p>Firstly we merge the two runs on the left into one.</p>
<p><img alt="" src="../images/ext_sort3.png" /></p>
<p>When merging two runs into one, we divide the buffer pool's frames into the input frames and output frame. There is only one output frame, the rest are inputs. </p>
<p>In this running example, we have two input frames and one output frame. </p>
<p><img alt="" src="../images/ext_sort4.png" /></p>
<p>We merge the run <code>[(2,3), (4,6), (9,9)]</code> with <code>[(3,5), (6,7), (8,11)]</code>.
We use list notation to denote a run, and a tuple to denote a page.</p>
<ol>
<li>We load the page <code>(2,3)</code> into an input frame and <code>(3,5)</code> into another input frame.</li>
<li>We find the smallest leading tuple from both frames, i.e. <code>2</code> and move it in the output frame</li>
<li>We repeat the same operation, and find <code>3</code>, which is moved to the output frame</li>
<li>The output frame is full and write it to disk.</li>
<li>The first input frame is not empty (because, we assume both <code>2</code> and  <code>3</code> are moved to the output frame). We load the second page <code>(4,6)</code> into this frame.</li>
<li>The process is repeated until both runs are processed.</li>
</ol>
<p>The 3<sup>rd</sup> run <code>[(0,1), (2,)]</code> is alone, hence there is no merging required.</p>
<p>At the end of phase 1, we have a new set of runs</p>
<p><code>[ [(2,3), (3,4), (5,6), (6,7), (8,9), (9,11)],  [(0,1), (2,1)] ]</code></p>
<h6 id="phase-2">Phase 2<a class="headerlink" href="#phase-2" title="Permanent link">&para;</a></h6>
<p>In this phase we merge the output from the phase into a single run</p>
<p><img alt="" src="../images/ext_sort5.png" /></p>
<h5 id="external-sort-algorithm">External sort algorithm<a class="headerlink" href="#external-sort-algorithm" title="Permanent link">&para;</a></h5>
<p>We consider the pseudo-code of the exernal sort algorithm. 
The algorithm is defined by a pseudo function <code>ext_sort(in_pages, bpool)</code>, which has the following input and output.</p>
<ul>
<li>input <ul>
<li>bpool - the buffer pool (in RAM)</li>
<li>in_pages - the pages to be sorted (on disk)</li>
</ul>
</li>
<li>output<ul>
<li>sorted results (on disk)</li>
</ul>
</li>
</ul>
<p>We find the pseudo code as follows</p>
<ol>
<li>def ext_sort(in_pages, bpool)<ol>
<li>let runs = divide_n_sort(in_pages, bpool)</li>
<li>while size_of(runs) &gt; 1<ol>
<li>let runs = merge(runs, bpool)</li>
</ol>
</li>
<li>return runs</li>
</ol>
</li>
</ol>
<p>At step 1.1, we call a helper function <code>divide_n_sort(in_pages, bpool)</code> to generate the initial runs, (phase 0). 
Steps 1.2 to 1.3 define the merging phases (phase 1, phase 2, .., etc). We repeatly call the helper function <code>merge(runs, run_size, bpool)</code> to merge the current runs set until all runs are merged into a single run.</p>
<h6 id="helper-function-divide_n_sort">Helper function divide_n_sort<a class="headerlink" href="#helper-function-divide_n_sort" title="Permanent link">&para;</a></h6>
<p>Next we consider the helper function <code>divide_n_sort(in_pages, bpool)</code>, which has the following input and output</p>
<ul>
<li>input<ul>
<li>bpool - the buffer pool (in RAM)</li>
<li>in_pages - the pages to be sorted (on disk)</li>
</ul>
</li>
<li>
<p>output</p>
<ul>
<li>runs - list of lists (on disk). Each inner list (a run) consists of a set of sorted data. (on disk)</li>
</ul>
</li>
<li>
<p>def divide_n_sort(in_pages, bpool)</p>
<ol>
<li>let count = 0</li>
<li>let m = size_of(bpool)</li>
<li>initialize runs to be an empty list (on disk)</li>
<li>while (m * count) &lt; size_of(in_pages)<ol>
<li>load the m pages from in_pages at offset (m * count)</li>
<li>sort data in bpool</li>
<li>group these m sorted pages into one run (on disk)</li>
<li>append run to runs (on disk)</li>
<li>increase count by 1 </li>
</ol>
</li>
<li>return runs</li>
</ol>
</li>
</ul>
<h6 id="helper-function-merge">Helper function merge<a class="headerlink" href="#helper-function-merge" title="Permanent link">&para;</a></h6>
<p>We consider the pseudo code of the function <code>merge(runs, bpool)</code></p>
<ul>
<li>input <ul>
<li>bpool - the buffer pool (in RAM)</li>
<li>runs - the list of lists (on disk), each inner list (a run) consists of a set of sorted data. (on disk)</li>
</ul>
</li>
<li>
<p>output</p>
<ul>
<li>next_runs - the runs in next phase (on disk)</li>
</ul>
</li>
<li>
<p>def merge(runs, bpool)</p>
<ol>
<li>initialize next_runs to be an empty list (on disk)</li>
<li>let m = size_of(bpool)</li>
<li>let l = size_of(runs)</li>
<li>divide bpool into m-1 and 1 frames<ol>
<li>let in_frames = m-1 frames of bpool for input </li>
<li>let out_frame = 1 frame of bpool for output</li>
</ol>
</li>
<li>let count = 0</li>
<li>while (m-1)*count &lt; l<ol>
<li>let batch =  extract m-1 runs from runs at offset (m-1) * count</li>
<li>let out_run  =  merge_one(batch, in_frames, out_frame)</li>
<li>append out_run to next_runs</li>
<li>increment count by 1</li>
</ol>
</li>
<li>return next_runs</li>
</ol>
</li>
</ul>
<p>The merge function processes the runs by merging every batch (consist of b-1 runs) into a larger run for the next phase, where b is the size of the buffer pool. It utilizes another helper function <code>merge_one(runs, bpool)</code> to merge a batch, which has the following signature and definition</p>
<ul>
<li>input<ul>
<li>batch - a segment from global runs. In variant, size_of(batch) &lt;= size_of(in_frames)</li>
<li>in_frame - frames set aside for input pages</li>
<li>out_frame - output frame set aside for output.</li>
</ul>
</li>
<li>
<p>output</p>
<ul>
<li>output_run (on disk)</li>
</ul>
</li>
<li>
<p>def merge_one(batch, in_frames, out_frame)</p>
<ol>
<li>initialize output_run to be an empty collection</li>
<li>let m = size_of(in_frames)</li>
<li>while (batch is not empty) and not (all in_frames isempty)<ol>
<li>for i in (0 to m)<ol>
<li>if in_frames[i] is empty and batch[i] is not empty <ol>
<li>load a page batch[i] to in_frames[i]</li>
</ol>
</li>
</ol>
</li>
<li>find the smallest record from the leading tuples from in_frames[0] to in_frames[m], move it to out_frame</li>
<li>if out_frame is full, write it to output_run</li>
</ol>
</li>
<li>return output_run</li>
</ol>
</li>
</ul>
<h4 id="cost-estimation-for-external-sort">Cost estimation for External sort<a class="headerlink" href="#cost-estimation-for-external-sort" title="Permanent link">&para;</a></h4>
<p>Assuming the size of <code>in_pages</code> is <span class="arithmatex">\(n\)</span>, and the buffer pool size is <span class="arithmatex">\(m\)</span>, we consider the estimated cost (disk I/Os) of external sort algorithm.</p>
<p>The <code>ext_sort</code> function has two main parts. The phase 0, the <code>divide_n_sort</code> function call and the while loop, i.e.  phase i where i&gt;0.</p>
<ul>
<li>In <code>divide_n_sort</code>, we read each page to be sorted once and write back to disk once. Hence the cost is <span class="arithmatex">\(2 \cdot n\)</span>.</li>
<li>In each iteration of the while loop in ext_sort function, we merge every <span class="arithmatex">\(m-1\)</span> runs into a single run, until all runs are merged. There should be <span class="arithmatex">\(\lceil log_{(m-1)}(\lceil n/m \rceil) \rceil\)</span> iterations. For each iteration, we read and write each page once. Hence the cost is <span class="arithmatex">\(2 \cdot  n \cdot  \lceil log_{(m-1)}(\lceil n/m \rceil)\rceil\)</span>.</li>
</ul>
<h2 id="join-operation">Join Operation<a class="headerlink" href="#join-operation" title="Permanent link">&para;</a></h2>
<p>Lastly, we consider the implementation of the join operation.</p>
<p>Let <span class="arithmatex">\(R\)</span> and <span class="arithmatex">\(S\)</span> be relations. There are several ways of implementing <span class="arithmatex">\(R \bowtie_{c} S\)</span>. </p>
<ul>
<li>The most naive implementation is to compute <span class="arithmatex">\(\sigma_{c}(R \times S)\)</span>. It is costly, because of the computation of cartesian product.</li>
<li>Alternatively, we may use a nested loop</li>
</ul>
<h3 id="nested-loop-join">Nested Loop Join<a class="headerlink" href="#nested-loop-join" title="Permanent link">&para;</a></h3>
<p>One possible approach is to use nested loop </p>
<ol>
<li>for each tuple <span class="arithmatex">\(t\)</span> in <span class="arithmatex">\(R\)</span><ol>
<li>for each tuple <span class="arithmatex">\(u\)</span> in <span class="arithmatex">\(S\)</span><ol>
<li>if <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(u\)</span> satisfy <span class="arithmatex">\(c\)</span>, output <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(u\)</span>.</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>The cost of this approach is <span class="arithmatex">\(B(R) + |R| \cdot B(S)\)</span>. The <span class="arithmatex">\(B(R)\)</span> is total cost of loading all tuples from <span class="arithmatex">\(R\)</span> once. For each tuple of <span class="arithmatex">\(R\)</span>, it will be compared with every tuple in <span class="arithmatex">\(S\)</span>, hence <span class="arithmatex">\(|R| \cdot B(S)\)</span>.</p>
<p>If we flip the outer/inner relation roles of <span class="arithmatex">\(R\)</span> and <span class="arithmatex">\(S\)</span>, we get the following cost <span class="arithmatex">\(B(S) + |S| \cdot B(R)\)</span>.</p>
<h3 id="block-nested-loop-join">Block Nested Loop Join<a class="headerlink" href="#block-nested-loop-join" title="Permanent link">&para;</a></h3>
<p>One obvious issue with the nested loop join is that it only utilizes three frames of the buffer pool, 1 frame for <span class="arithmatex">\(R\)</span> and 1 frame for <span class="arithmatex">\(S\)</span> and 1 frame for the output. The frame of <span class="arithmatex">\(S\)</span> is evicted everytime a tuple in <span class="arithmatex">\(R\)</span> is checked. </p>
<p>We could speed up nested loop join by utilizing all frames of the buffer pool. </p>
<p>Assuming the buffer pool is of size <span class="arithmatex">\(m\)</span>, we divide the buffer pool into <span class="arithmatex">\(m-2\)</span> frames for loading <span class="arithmatex">\(R\)</span> and 1 frame for loading <span class="arithmatex">\(S\)</span> and 1 frame for output</p>
<ol>
<li>for each <span class="arithmatex">\(m-2\)</span> pages in <span class="arithmatex">\(R\)</span>, we extract each tuple <span class="arithmatex">\(t\)</span><ol>
<li>for each page in <span class="arithmatex">\(S\)</span>, we extract each tuple <span class="arithmatex">\(u\)</span>.<ol>
<li>if <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(u\)</span> satisfy <span class="arithmatex">\(c\)</span>, output <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(u\)</span>.</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>The cost of this approach is <span class="arithmatex">\(B(R) + \lceil B(R) / (m - 2) \rceil \cdot B(S)\)</span>.
The cost will be <span class="arithmatex">\(B(S) + \lceil B(S) / (m - 2) \rceil \cdot B(R)\)</span> if the outer/inner relations are swapped.</p>
<h3 id="index-nested-loop-join">Index Nested Loop Join<a class="headerlink" href="#index-nested-loop-join" title="Permanent link">&para;</a></h3>
<p>If the join predicate <span class="arithmatex">\(c\)</span> is <span class="arithmatex">\(R.a = S.b\)</span> and an index attribute exists for <span class="arithmatex">\(S.b\)</span>, we can optimize the nested loop join by using the indexed relation as the inner relation. </p>
<ol>
<li>for each tuple <span class="arithmatex">\(t\)</span> in <span class="arithmatex">\(R\)</span><ol>
<li>find the tuple <span class="arithmatex">\(u\)</span> in <span class="arithmatex">\(S\)</span> with <span class="arithmatex">\(u.b = t.c\)</span> using index <ol>
<li>output <span class="arithmatex">\(t\)</span> and <span class="arithmatex">\(u\)</span>.</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>If the index is clustered, the cost of this approach is <span class="arithmatex">\(B(R) + |R| \cdot K\)</span> where <span class="arithmatex">\(K\)</span> is a constant dependent on the structure of the index or the height of the B+ Tree index. E.g. if the height of the B+ Tree is 3, then <span class="arithmatex">\(K = 4\)</span> assuming each node occupying a page. </p>
<p>When the index is not clustered, the cost will become <span class="arithmatex">\(B(R) + |R| \cdot K \cdot j\)</span> where <span class="arithmatex">\(j\)</span> is the maximum number of tuples of <span class="arithmatex">\(S\)</span> sharing one key. </p>
<p>An extreme case where <span class="arithmatex">\(R\)</span> is sorted by <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(S.b\)</span> is a clustered index. The total cost is <span class="arithmatex">\(B(R) + B(S)\)</span>. </p>
<h3 id="sort-merge-join">Sort Merge Join<a class="headerlink" href="#sort-merge-join" title="Permanent link">&para;</a></h3>
<p>The fourth alternative is sort merge join. </p>
<ol>
<li>Sort <span class="arithmatex">\(R\)</span> by the attribute used in <span class="arithmatex">\(c\)</span></li>
<li>Sort <span class="arithmatex">\(S\)</span> by the attribute used in <span class="arithmatex">\(c\)</span></li>
<li>Merge the sorted <span class="arithmatex">\(R\)</span> and sorted <span class="arithmatex">\(S\)</span> like external sort</li>
</ol>
<p>The cost of step 1 is</p>
<div class="arithmatex">\[2\cdot B(R) \cdot (1 + \lceil log_{m-1}(\lceil B(R) / m \rceil)\rceil)\]</div>
<p>The cost of step 2 is </p>
<div class="arithmatex">\[2\cdot B(S) \cdot (1 + \lceil log_{m-1}(\lceil B(S) / m \rceil)\rceil)\]</div>
<p>The cost of step 3 is </p>
<div class="arithmatex">\[B(R) +  B(S)\]</div>
<h3 id="hash-join">Hash Join<a class="headerlink" href="#hash-join" title="Permanent link">&para;</a></h3>
<p>The fourth alternative is to make use of an in-memory hash table.</p>
<p>Assuming we hash the join attribute used in <span class="arithmatex">\(c\)</span> of <span class="arithmatex">\(S\)</span> and stored it in a hash table, and the hash table is fitting in the RAM, (one big assumption), we can compute join by</p>
<ol>
<li>for each tuple <span class="arithmatex">\(u\)</span> in <span class="arithmatex">\(S\)</span><ol>
<li>add <span class="arithmatex">\(u\)</span> (projected attributes) to HT</li>
</ol>
</li>
<li>for each tuple <span class="arithmatex">\(t\)</span> in <span class="arithmatex">\(R\)</span><ol>
<li>lookup <span class="arithmatex">\(t\)</span>'s attribute in HT<ol>
<li>output <span class="arithmatex">\(t\)</span> and the value in HT</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>The cost of this approach is <span class="arithmatex">\(B(R) +B(S)\)</span> because we scan both tables exactly once.</p>
<h3 id="grace-hash-join">Grace Hash Join<a class="headerlink" href="#grace-hash-join" title="Permanent link">&para;</a></h3>
<p>The Hash Join is perhaps impractical, as in most of the cases, the hash table can't fit in the RAM. </p>
<p>The assumption - there exists a hash function <span class="arithmatex">\(h\)</span> such that </p>
<ol>
<li><span class="arithmatex">\(R\)</span> can be partitioned into <span class="arithmatex">\(n\)</span> partitions by <span class="arithmatex">\(h\)</span> and <span class="arithmatex">\(n \leq m - 1\)</span>, and none of the partitions have more than <span class="arithmatex">\(m-1\)</span> pages, or </li>
<li><span class="arithmatex">\(S\)</span> can be partitioned into <span class="arithmatex">\(n\)</span> partitions by <span class="arithmatex">\(h\)</span> and <span class="arithmatex">\(n \leq m - 1\)</span>, and none of the partitions have more than <span class="arithmatex">\(m-1\)</span> pages.</li>
</ol>
<p>The algorithm works as follows</p>
<ol>
<li>partition <span class="arithmatex">\(R\)</span> and <span class="arithmatex">\(S\)</span> by <span class="arithmatex">\(h\)</span></li>
<li>If <span class="arithmatex">\(S\)</span> is the relation that satisfies that assumption<ol>
<li>for each partition <span class="arithmatex">\(p_i\)</span> in <span class="arithmatex">\(S\)</span>, <ol>
<li>load pages in <span class="arithmatex">\(p_i\)</span> into the buffer pool, and build a in-memory hashtable using a different hash function <span class="arithmatex">\(h_2\)</span></li>
<li>load data (page by page) from partition <span class="arithmatex">\(q_i\)</span> in <span class="arithmatex">\(R\)</span> (values in <span class="arithmatex">\(q_i\)</span> and <span class="arithmatex">\(p_i\)</span> should share the same hash values of <span class="arithmatex">\(h\)</span>)</li>
<li>look up the data in the hash table with <span class="arithmatex">\(h_2\)</span>, output if a match is found.</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>The total cost of the Grace Hash Join is </p>
<div class="arithmatex">\[ 3 \cdot (B(R) + B(S)) \]</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.expand", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>